(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{1214:function(e,a,t){"use strict";var n=t(1),r=t.n(n),s=t(1216),c=t.n(s);a.a=function(e){var a=e.children,t=e.icon,n=e.text;return r.a.createElement("div",{className:c.a.sectionContainer},r.a.createElement("div",{className:c.a.iconContainer},t),r.a.createElement("span",{className:c.a.sectionLabel},n),a)}},1216:function(e,a,t){e.exports={sectionContainer:"explainingLabels_sectionContainer__1n9BX",iconContainer:"explainingLabels_iconContainer__1r1N2",sectionLabel:"explainingLabels_sectionLabel__Jgmvz"}},1221:function(e,a,t){"use strict";var n=t(1),r=t.n(n),s=t(1248),c=t.n(s);a.a=function(e){var a=e.children;return r.a.createElement("ul",{className:c.a.container},a)}},1223:function(e,a,t){"use strict";var n=t(22),r=t(50),s=t(1),c=t.n(s),i=function(e){var a=e.loadMoreButton,t=void 0===a?c.a.createElement("button",null,"Load more"):a,i=e.loader,o=void 0===i?c.a.createElement("span",null,"loading..."):i,l=e.threshold,u=void 0===l?200:l,m=e.toBottom,g=void 0!==m&&m,f=e.byWindow,d=e.fetcher,p=e.withScrollHandler,_=e.getScrollParent,v=e.className,b=e.children,E=Object(r.a)(e,["loadMoreButton","loader","threshold","toBottom","byWindow","fetcher","withScrollHandler","getScrollParent","className","children"]),h=Object(s.useState)({isFetching:!1,page:0,lastPage:0}),y=Object(n.a)(h,2),j=y[0],O=j.isFetching,M=j.page,w=j.lastPage,x=y[1],N=Object(s.useRef)(null),S=M<w;Object(s.useEffect)(function(){x({isFetching:!0});var e=d(M+1);e instanceof Promise?e.then(function(e){var a=e.page,t=e.lastPage;x({isFetching:!1,page:a,lastPage:t}),"boolean"===typeof g&&g&&"function"===typeof N.current.scrollTo?N.current&&N.current.scrollTo(0,N.current.scrollHeight):g&&g.current&&"function"===typeof g.current.scrollTo&&g.current.scrollTo(0,g.current.scrollHeight)}):x({isFetching:!1}),"undefined"!==typeof _&&_(N)},[]);var C=function(){S&&(x({isFetching:!0}),d(M+1).then(function(e){var a=e.page,t=e.lastPage;x({isFetching:!1,page:a,lastPage:t})}))};return c.a.createElement("div",Object.assign({ref:N,className:v,onScroll:function(){var e=f?window.scrollY-u:N.current.scrollTop;p&&!O&&S&&e-u<=0&&C()}},E),S&&!p&&!O&&c.a.cloneElement(t,{onClick:C}),O&&o,b)};t.d(a,"a",function(){return i})},1225:function(e,a,t){"use strict";t.d(a,"a",function(){return s}),t.d(a,"b",function(){return c});var n=t(18),r=t(19),s=function(e){return n.a.get("".concat(r.a.dialogs,"?page=").concat(e))},c=function(e,a){return n.a.get("".concat(r.a.dialogs,"/").concat(e,"?page=").concat(a))}},1233:function(e,a,t){"use strict";var n=t(1221);t.d(a,"a",function(){return n.a})},1243:function(e,a,t){"use strict";t(59);var n=t(17),r=t(1214),s=t(1),c=t.n(s),i={fontSize:21};a.a=function(){return c.a.createElement(r.a,{icon:c.a.createElement(n.a,{type:"stop",style:i}),text:"Blacklisted"},c.a.createElement("span",null,"You are blacklisted by this user"))}},1248:function(e,a,t){e.exports={container:"optionsModal_container__1GZNV"}},1261:function(e,a,t){"use strict";var n=t(22),r=t(1),s=t.n(r),c=function(e){var a=e.className,t=Object(r.useState)(3),c=Object(n.a)(t,2),i=c[0],o=c[1];return Object(r.useEffect)(function(){var e=setTimeout(function(){o(3===i?1:i+1)},300);return function(){return clearTimeout(e)}}),s.a.createElement("span",{className:a},"is typing ",".".repeat(i))};t.d(a,"a",function(){return c})},1413:function(e,a,t){e.exports={container:"header_container__13v6o",arrowLeft:"header_arrowLeft__2hFbt",avatar:"header_avatar__1t7-n",username:"header_username__PLVMw",isTyping:"header_isTyping__2sruO"}},1419:function(e,a,t){e.exports={container:"emojiPicker_container__1J-Eh"}},1421:function(e,a,t){e.exports=t.p+"static/media/smile.8472c08c.svg"},1422:function(e,a,t){e.exports={container:"footer_container__rIBtM",messageInput:"footer_messageInput__2hJ6h",sendButton:"footer_sendButton__1f7ws",loader:"footer_loader__1YWfX",inputContainer:"footer_inputContainer__2nqf2",emojiIcon:"footer_emojiIcon__3UBAj"}},1424:function(e,a,t){e.exports={wrapper:"post_wrapper__3wMBq",container:"post_container__2qTmd",myContainer:"post_myContainer__3aS36 post_container__2qTmd",header:"post_header__2O9bl",avatar:"post_avatar__6sa51",username:"post_username__16Nhd",media:"post_media__w0ueq",caption:"post_caption__2D8bf"}},1426:function(e,a,t){e.exports={avatar:"avatar_avatar__3VjgK"}},1428:function(e,a,t){e.exports={container:"fullScreen_container__3ERjB",scale:"fullScreen_scale__2AHTC"}},1430:function(e,a,t){e.exports={img:"image_img__2i6r3",imgFull:"image_imgFull__1f3oh"}},1432:function(e,a,t){e.exports={container:"images_container__Kvgv5"}},1434:function(e,a,t){e.exports={singleImgContainer:"singleImage_singleImgContainer__1iVZY",mySingleImgContainer:"singleImage_mySingleImgContainer__37mDz singleImage_singleImgContainer__1iVZY"}},1436:function(e,a,t){e.exports={wrapper:"message_wrapper__2TbOf",myWrapper:"message_myWrapper__JYQXd message_wrapper__2TbOf",container:"message_container__xwdr5",text:"message_text__Vsz9G",myText:"message_myText__33g_T message_text__Vsz9G",unreadBadge:"message_unreadBadge__doRGv",myTime:"message_myTime__3Lwsy",time:"message_time__2zaNB message_myTime__3Lwsy"}},1439:function(e,a,t){e.exports={container:"messagesList_container__S-sNe",absoluteWrapper:"messagesList_absoluteWrapper__2ZwQR",messages:"messagesList_messages__WD0US",mobileMessages:"messagesList_mobileMessages__3wVZT messagesList_messages__WD0US",explainingContainer:"messagesList_explainingContainer__3oDh7 dialog_container__1JFX1",date:"messagesList_date__2uHkP"}},1441:function(e,a,t){e.exports={container:"dialog_container__1JFX1",explainingContainer:"dialog_explainingContainer__3naOs dialog_container__1JFX1"}},1453:function(e,a,t){"use strict";t.r(a);t(248);var n=t(123),r=t(22),s=t(1),c=t.n(s),i=t(37),o=t(1243),l=t(355),u=(t(59),t(17)),m=t(1446),g=t(1280),f=t(94),d=t(1261),p=t(1413),_=t.n(p),v=Object(g.a)(function(e){var a=e.username,t=e.avatar,n=e.isTyping,r=e.history;return c.a.createElement("div",{className:_.a.container},c.a.createElement(u.a,{type:"arrow-left",className:_.a.arrowLeft,onClick:r.goBack}),c.a.createElement(m.a,{to:"/".concat(a),className:_.a.avatar},t?c.a.createElement("img",{src:t,alt:"avatar"}):c.a.createElement(f.a,{fontSize:"20px"})),c.a.createElement(m.a,{to:"/".concat(a),className:_.a.username},a),n&&c.a.createElement(d.a,{className:_.a.isTyping}))}),b=t(1415),E=t(1442),h=(t(1417),t(1419)),y=t.n(h),j=function(e){var a=e.addEmoji;return c.a.createElement("div",{className:y.a.container},c.a.createElement(E.a,{set:"apple",color:"#1890ff",title:"Pick emoji",emoji:"point_up",onSelect:a}))},O=t(1421),M=t.n(O),w=t(1422),x=t.n(w),N=function(e){var a=e.sendMessage,t=e.typing,n=Object(s.useRef)(null),i=Object(s.useState)(!1),o=Object(r.a)(i,2),l=o[0],u=o[1],m=Object(s.useState)(!1),g=Object(r.a)(m,2),f=g[0],d=g[1],p=Object(s.useState)(""),_=Object(r.a)(p,2),v=_[0],E=_[1],h=Object(b.useThrottle)(v,1200);Object(s.useEffect)(function(){h.length>0&&t()},[h]);var y=Object(s.useCallback)(function(e){v.length<1e3&&(E(v+e.native),n.current.focus(),l||u(!0))},[v]);return c.a.createElement(c.a.Fragment,null,c.a.createElement("form",{className:x.a.container,onSubmit:function(e){e.preventDefault(),v.length>0&&v.length<=1e3&&(a(v),E(""),u(!1),d(!1),n.current.focus())}},c.a.createElement("div",{className:x.a.inputContainer},c.a.createElement("input",{type:"text",placeholder:"Enter your message",ref:n,className:x.a.messageInput,maxLength:1e3,value:v,onChange:function(e){var a=e.target.value;!l&&a.length>0?u(!0):0===e.target.value.length&&u(!1),a.length<1e3&&E(a)}}),c.a.createElement("button",{type:"button",className:x.a.emojiIcon,onClick:function(){d(!f)}},c.a.createElement("img",{src:M.a,alt:"Emoji"}))),l&&c.a.createElement("button",{className:x.a.sendButton,type:"submit"},"Send")),f&&c.a.createElement(j,{addEmoji:y}))},S=t(27),C=t.n(S),k=t(132),T=t(1223),I=t(1214),L={fontSize:21},D=function(){return c.a.createElement(I.a,{icon:c.a.createElement(u.a,{type:"message",style:L}),text:"Start messaging!"},c.a.createElement("span",null,"Send the first message to start a conversation"))},P=t(1250),F=t.n(P),B=t(1233),Y=t(360),A=t(1424),R=t.n(A),G=function(e){var a=e.post,t=e.my,n=e.postCode;return c.a.createElement("div",{className:R.a.wrapper},c.a.createElement(m.a,{to:"/p/".concat(n),className:t?R.a.myContainer:R.a.container,onClick:function(e){a.error&&e.preventDefault()}},c.a.createElement("div",{className:R.a.header},c.a.createElement("img",{src:a.avatar,className:R.a.avatar,alt:""}),c.a.createElement("span",{className:R.a.username},a.owner)),a.error?c.a.createElement("div",{className:R.a.media,error:"Post is no longer available"}):a.src&&a.src.match(".mp4")?c.a.createElement("video",{src:a.src,className:R.a.media}):c.a.createElement("img",{src:a.src,className:R.a.media,alt:"Post"}),a.caption&&c.a.createElement("span",{className:R.a.caption},a.caption)))},W=t(1426),z=t.n(W),H=c.a.memo(function(e){var a=e.my,t=e.post,n=e.images,r=e.username,s=e.src;return c.a.createElement(c.a.Fragment,null,!a&&!t&&!n&&c.a.createElement(m.a,{to:"/".concat(r),className:z.a.avatar},s?c.a.createElement("img",{src:s,alt:"avatar"}):c.a.createElement(f.a,{fontSize:"20px"})))}),J=t(50),V=t(1266),X=(t(1267),t(7)),q=t(1428),Z=t.n(q),U=document.getElementById("root"),$=function(e){var a=e.children,t=e.onClose,n=Object(J.a)(e,["children","onClose"]);return Object(s.useEffect)(function(){var e=function(e){27===e.keyCode&&t()};return document.addEventListener("keydown",e),function(){document.body.style.overflow="visible",document.removeEventListener("keydown",e)}},[]),Object(X.createPortal)(c.a.createElement("div",Object.assign({className:Z.a.container,onClick:t},n),a),U)},K=t(1430),Q=t.n(K),ee=function(e){var a=e.src,t=Object(J.a)(e,["src"]),n=Object(s.useState)(!1),i=Object(r.a)(n,2),o=i[0],l=i[1];return c.a.createElement(c.a.Fragment,null,o&&c.a.createElement($,{onClose:function(e){e&&e.stopPropagation(),l(!1)}},c.a.createElement("img",{src:a,className:Q.a.imgFull,alt:""})),c.a.createElement(V.LazyLoadImage,Object.assign({src:a,alt:"Media",effect:"blur",onClick:function(e){e.stopPropagation(),l(!0)},wrapperClassName:Q.a.img},t)))},ae=t(1432),te=t.n(ae),ne=function(e){var a=e.images;return c.a.createElement("div",{className:te.a.container},a&&a.map(function(e,a){return c.a.createElement(ee,{key:a,src:e})}))},re=t(1434),se=t.n(re),ce=function(e){var a=e.my,t=e.images;return c.a.createElement("div",{className:a?se.a.mySingleImgContainer:se.a.singleImgContainer},t&&t.map(function(e){return c.a.createElement(ee,{key:"key",src:e})}))},ie=t(1436),oe=t.n(ie),le=function(e){var a=e.id,t=e.username,n=e.avatar,i=e.post,o=e.images,l=e.text,u=e.my,m=e.read,g=e.time,f=e.deleteMsg,d=e.withAvatar,p=void 0!==d&&d,_=Object(s.useState)(!1),v=Object(r.a)(_,2),b=v[0],E=v[1],h=Object(s.useCallback)(function(){E(!1)},[]),y=Object(s.useCallback)(function(){f(a)},[]);return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:u?oe.a.myWrapper:oe.a.wrapper,onClick:function(){u&&E(!0)}},p&&c.a.createElement(H,{my:u,post:i,src:n,images:o,username:t}),i?c.a.createElement(G,{post:i,my:u,postCode:l.split("/")[4]}):c.a.createElement("div",{className:oe.a.container},l.length>0||o&&o.length>1?c.a.createElement("div",{className:u?oe.a.myText:oe.a.text},u&&!m&&c.a.createElement("div",{className:oe.a.unreadBadge}),c.a.createElement(F.a,null,l),c.a.createElement(ne,{images:o})):c.a.createElement(ce,{my:u,images:o})),c.a.createElement("time",{className:u?oe.a.myTime:oe.a.time},C()(g).format("HH:mm"))),c.a.createElement(Y.a,{visible:b,onClose:h},c.a.createElement(B.a,null,C()().diff(g,"hours")<=24&&c.a.createElement("li",{onClick:y},"Delete"),c.a.createElement("li",{onClick:h},"Cancel"))))},ue=t(1438),me=t(1444),ge=function(e){var a=e.children,t=Object(ue.b)(function(){return{x:0}}),n=Object(r.a)(t,2),s=n[0].x,i=n[1],o=Object(me.a)({onStartShouldSet:function(){return!0},onMove:function(e){var a=e.delta;e.xy,a[0]>0?i({x:0,immediate:!0}):a[0]<-400?i({x:-400,immediate:!0}):i({x:a[0],immediate:!0})},onRelease:function(e){e.delta,i({x:0,immediate:!1})}}).bind;return c.a.createElement(ue.a.div,Object.assign({},o,{style:{transform:s.interpolate(function(e){return"translateX(".concat(function(e){return Math.abs(e)>40?e+.6*(Math.abs(e)-40)*(e<0?1:-1):e}(e),"px)")})}}),a)},fe=t(1439),de=t.n(fe),pe=function(e){var a=e.messages,t=e.getScrollParent,n=e.user,r=e.myId,i=e.getMessages,o=e.deleteMsg,u=e.isFirstLoading,m=Object(s.useRef)(null),g=function(e,a){var t=e[a-1];return!!Object.is(t,void 0)||t&&t.owner_id!==e[a].owner_id};return c.a.createElement(T.a,{fetcher:i,loader:c.a.createElement(l.a,null),withScrollHandler:!0,getScrollParent:t,className:de.a.container,toBottom:!0},c.a.createElement(ge,null,c.a.createElement("div",{className:Object(k.a)()?de.a.mobileMessages:de.a.messages},c.a.createElement("div",{className:de.a.absoluteWrapper},u||0!==a.length?a.map(function(e,t){return c.a.createElement(c.a.Fragment,null,function(e){var a;if(m.current){var t=C()(m.current),n=C()(e);t.format("D MMMM YYYY")!==n.format("D MMMM YYYY")&&(a=t.year()===n.year()?n.format("D MMMM")===C()().format("D MMMM")?"today":n.format("D MMMM"):n.format("D MMMM YYYY"))}else a=C()(e).format("D MMMM")===C()().format("D MMMM")?"today":C()(e).format("D MMMM");return m.current=e,a&&c.a.createElement("div",{className:de.a.date},a)}(e.created_at),c.a.createElement(le,{key:e.id,id:e.id,my:e.owner_id===r,avatar:n&&n.avatar,username:n&&n.username,withAvatar:g(a,t),text:e.text,read:e.read,time:e.created_at,images:e.images,post:e.post,deleteMsg:o}))}):c.a.createElement("div",{className:de.a.explainingContainer},c.a.createElement(D,null))))))},_e=t(66),ve=t(359),be=t(26),Ee=t(13),he=t(14),ye=t.n(he),je=t(25),Oe=t(72),Me=t(1225),we=function(){var e=Object(je.a)(ye.a.mark(function e(a){var t,n;return ye.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=a.match(/https?:\/\/[^"' ]+\.(?:png|jpg|jpeg|gif).*?(?=( |$))/g))&&t.length>0)){e.next=6;break}return e.next=4,Promise.allSettled(t.map(xe));case 4:return n=e.sent,e.abrupt("return",n.filter(function(e){return"rejected"!==e.state}).map(function(e){return e.value}));case 6:return e.abrupt("return",null);case 7:case"end":return e.stop()}},e)}));return function(a){return e.apply(this,arguments)}}();function xe(e){return new Promise(function(a,t){var n,r=new Image;r.onerror=r.onabort=function(){clearTimeout(n),t()},r.onload=function(){clearTimeout(n),a(e)},n=setTimeout(function(){t()},2e3),r.src=e})}var Ne=function(e){var a=e.match(/^https?:\/\/([^\/?#]+)(?:[\/?#]|$)/i);return a&&a.length>=2?e.split("/")[4]:null},Se=function(){var e=Object(je.a)(ye.a.mark(function e(a){var t,n;return ye.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,!a){e.next=6;break}if(!(n=Ne(a))||36!==n.length){e.next=6;break}return e.next=6,Oe.g(n).then(function(e){var a=e.data;t=a.post}).catch(function(e){t={error:e.message}});case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}},e)}));return function(a){return e.apply(this,arguments)}}(),Ce=function(){var e=Object(je.a)(ye.a.mark(function e(a){var t,n,r;return ye.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.message,e.next=3,Se(t);case 3:return n=e.sent,e.next=6,we(t);case 6:return r=e.sent,Array.isArray(r)&&(Object.is(r[0],void 0)?r=null:t=t.replace(/https?:\/\/[^"' ]+\.(?:png|jpg|jpeg|gif|mp4).*?(?=( |$))/g,"")),e.abrupt("return",Object(Ee.a)({},a,{post:n,images:r,text:t}));case 9:case"end":return e.stop()}},e)}));return function(a){return e.apply(this,arguments)}}(),ke={messages:[]},Te="READ_MESSAGES",Ie="ADD_MESSAGES",Le="ADD_MESSAGE",De="DELETE_MESSAGE";function Pe(e,a){switch(a.type){case Te:return{messages:e.messages.map(function(e){return e.read?e:(e.read=!0,Object(Ee.a)({},e))})};case Ie:return{messages:[].concat(Object(be.a)(a.payload),Object(be.a)(e.messages))};case Le:return e.messages.some(function(e){return e.id===a.payload.id})?{messages:e.messages}:{messages:[].concat(Object(be.a)(e.messages),[a.payload])};case De:return{messages:e.messages.filter(function(e){return e.id!==a.payload})};default:throw new Error}}var Fe=function(e){var a=Object(s.useReducer)(Pe,ke),t=Object(r.a)(a,2),n=t[0].messages,c=t[1],i=Object(s.useRef)(null),o=Object(s.useRef)(!0);return{messages:n,addMessage:Object(s.useCallback)(function(e){Ce(e).then(function(e){c({type:Le,payload:e}),i.current()})},[]),getMessages:function(a){return new Promise(function(t){Me.b(e,a).then(function(){var e=Object(je.a)(ye.a.mark(function e(a){var n;return ye.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=a.data,Promise.all(n.data.map(function(e){return Ce(e)})).then(function(e){o.current=!1,c({type:Ie,payload:e}),t(n)});case 2:case"end":return e.stop()}},e)}));return function(a){return e.apply(this,arguments)}}())})},readAllMessages:function(){c({type:Te})},onNewMessage:function(e){i.current=e},deleteMessage:Object(s.useCallback)(function(e){c({type:De,payload:e})},[]),isFirstLoading:o.current}},Be=t(1441),Ye=t.n(Be),Ae=Object(i.b)(function(e){return{myId:e.auth.user.id}})(function(e){var a=e.myId,t=e.dispatch,i=e.match.params.username,u=Object(s.useState)(null),m=Object(r.a)(u,2),g=m[0],f=m[1],d=Object(s.useState)(!1),p=Object(r.a)(d,2),_=p[0],b=p[1],E=Object(s.useRef)(null),h=Object(s.useRef)(null),y=Fe(i),j=y.messages,O=y.getMessages,M=y.addMessage,w=y.readAllMessages,x=y.onNewMessage,S=y.deleteMessage,C=y.isFirstLoading,k="dialogs:".concat(a);Object(s.useEffect)(function(){_e.g(i).then(function(e){var a=e.data;f(a),t.auth.readDialog(a.id)})},[]),Object(s.useEffect)(function(){var e=ve.a.getSubscription(k);if(g&&a&&e){e.emit("message",{type:ve.c.CONNECTION,receiverId:g.id});var t=function(t){switch(t.type){case ve.c.MESSAGE:t.message.owner_id!==g.id&&t.message.owner_id!==a||(M(t.message),t.message.receiver_id===a&&(e.emit("message",{type:ve.c.READ,receiverId:g.id}),w()));break;case ve.c.CONNECTION:case ve.c.READ:w();break;case ve.c.IS_TYPING:if(t.owner_id===g.id){var r=Date.now();b(!0),h.current&&clearInterval(h.current),h.current=setTimeout(function(){r+1500<=Date.now()&&b(!1)},1600)}break;case ve.c.DELETE:S(t.messageId);break;case ve.c.ERROR:n.a.error(t.error)}};return e.on("message",t),E.current=e,function(){return e.off("message",t)}}},[g,a,ve.a.getSubscription(k)]);var T=Object(s.useCallback)(function(e){E.current.emit("message",{type:ve.c.MESSAGE,receiverId:g.id,message:e})},[E,g]),I=Object(s.useCallback)(function(){E.current.emit("message",{type:ve.c.IS_TYPING,receiverId:g.id})},[E,g]),L=Object(s.useCallback)(function(e){E.current.emit("message",{type:ve.c.DELETE,receiverId:g.id,messageId:e})},[E,g]);return c.a.createElement("div",{className:Ye.a.container},g?c.a.createElement(c.a.Fragment,null,g&&g.amBlacklisted?c.a.createElement("div",{className:Ye.a.explainingContainer},c.a.createElement(o.a,null)):c.a.createElement(c.a.Fragment,null,c.a.createElement(v,{username:i,avatar:g&&g.avatar,isTyping:_}),c.a.createElement(pe,{messages:j,user:g,myId:a,getMessages:O,isFirstLoading:C,deleteMsg:L,getScrollParent:function(e){x(function(){e.current.scrollTo({top:e.current.scrollHeight,behavior:"smooth"})})}}),c.a.createElement(N,{sendMessage:T,typing:I}))):c.a.createElement(l.a,{center:!0}))});t.d(a,"default",function(){return Ae})}}]);
//# sourceMappingURL=17.48f79212.chunk.js.map